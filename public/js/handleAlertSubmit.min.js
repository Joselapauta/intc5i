const userForm = document.getElementById('formMigracion');
const alertMessage = document.getElementById('alertMessage');
let res;


const apiRoutes = {
    
        'Migración': '/migration',
        'Decomisos': '/decomisos',
        'Armas y Municiones': 'formarmasymuniciones',
        'Actos Delictivos': 'formactosdelictivos',
        'Delitos Ambientales': 'formdelitosambientales',
        'Registro Aéreo': 'formregistroaereo'
    
}

const formAdapter = (form, inputsSelect) =>{
    const formData = {}
    const inputs = form.querySelector(inputsSelect.join(", "))
    inputs.forEach(input => {
        const name = input.name; 
        const value = input.value; 

        if (name) {  
            formData[name] = value;
        }
    });
}

document.addEventListener("submit", async e => {
    e.preventDefault()
    const form = e

    const bodyData = formAdapter(form, ["input", "select", "textarea"])
    const selectedRouter = apiRoutes[form.id];

    if (!selectedRouter) {
        alertMessage.style.display = 'block';
        alertMessage.innerHTML = `<div class='alert alert-error' role='alert'>${"Error al procesar el formulario"}</div>`;
        return
    }

    res = await doFetch(bodyData, selectedRouter)
    form.reset();

    if (res.status === 'success') {
        alertMessage.style.display = 'block';
        alertMessage.innerHTML = `<div class='alert alert-success' role='alert'>${res.message}</div>`;
    } else {
        alertMessage.style.display = 'block';
        alertMessage.innerHTML = `<div class='alert alert-warning' role='alert'>${res.message}</div>`;
    }
})


const doFetch = async (bodyData, router) =>{
    try {
        const res = await fetch(router, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            bodyform: JSON.stringify(bodyData)
        })
        if (res.ok) {
            const data = await res.json();
            
            return data;
        }
    } catch (error) {
        return { status: 'error', message: 'Error en la solicitud' };
    }
}